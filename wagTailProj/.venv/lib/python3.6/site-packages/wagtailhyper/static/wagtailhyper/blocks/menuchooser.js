(function () {
var MenuChooserField = function (page_search_url) {
    return {
        type: 'chooser',
        label: 'Menu Chooser',
        model: 'menu',
        chooserButtonText: 'Choose Menu',
        getItems: function(query, page, perPage, callback) {
            var str = 'q='+query + '&page='+page + '&perPage='+perPage
            fetch( page_search_url + '?' + str, {credentials: 'include'})
            .then(function(response) { return response.json() })
            .then(function(data) {
                callback({
                    total: data.total,
                    currentPage: data.current_page,
                    result: data.result,
                })
            })
        },

        displayItem: function(item) {
            return '<div class="card text-center"><div class="card-body"><h5 class="card-title">'+ item.title +'</h5></div></div>'
        },

        displaySelectedItem: function (item) {
            return '<div class="card text-center"><div class="card-body"><h5 class="card-title">'+ item.title +'</h5></div></div>'
        }
    }
}
var MenuChooserBlock = function (menuChooser) {
    return {
        title: 'Menu',
        description: 'Choose a Menu',
        default_values: {
            settings: {
                dropdownLevel: 0
            }
        },
        config: {
            preview: function (self, callback) {
                callback('Menu: ' + self.title)
            },
            styles: [{id: 'default', name: 'Default'}]
        },
        settings_schema: {
            fields: [
                {
                    'type': 'input',
                    'inputType': 'text',
                    'label': 'Title',
                    'model': 'title'
                },
                {
                    'type': 'input',
                    'inputType': 'number',
                    'label': 'Dropdown Max Level',
                    'model': 'dropdownLevel',
                    'default': 0
                },
                menuChooser
            ]
        }
    }
}

var menuChooserBlock = MenuChooserBlock(MenuChooserField(WAGTAIL_MENU_SEARCH_URL))
hyperEditor.register_block('menu', menuChooserBlock)
})()